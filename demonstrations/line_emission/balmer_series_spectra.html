

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Measuring line of sight spectra &mdash; CHERAB 1.01 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> CHERAB
          

          
          </a>

          
            
            
              <div class="version">
                1.01
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../welcome.html">1. Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../licence.html">2. Licence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation_and_structure.html">3. Installation and Project Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../available_modules.html">4. Available Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../atomic/atomic_data.html">5. Atomic Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core.html">6. Core Plasma Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../equilibrium.html">7. Plasma equilibrium</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plasma_sources.html">8. Plasma sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../models/emission_models.html">9. Emission Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../math.html">10. Math functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../utility.html">11. Utilities</a></li>
</ul>
<p class="caption"><span class="caption-text">Demonstrations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../demonstrations.html">Atomic Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demonstrations.html#code-examples-gallery">Code examples gallery</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CHERAB</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Measuring line of sight spectra</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/demonstrations/line_emission/balmer_series_spectra.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="measuring-line-of-sight-spectra">
<span id="balmer-series-spectra"></span><h1>Measuring line of sight spectra<a class="headerlink" href="#measuring-line-of-sight-spectra" title="Permalink to this headline">¶</a></h1>
<p>CHERAB is capable of simulating spectroscopic measurements. In this example we
simulate a basic measurement of the balmer series in the MAST-U divertor with
an optical fibre.</p>
<p>By default, Raysect images are ray-traced to give line integrated spectra which
can sometimes be difficult to interpret without knowing the localisation
of the emission. Sometimes the emission can be highly localised, and other times
very diffuse. This example also shows some techniques for visualising the emission
locations and plasma parameters along the ray trajectory. The full demo file for
this tutorial can be downloaded from
<a class="reference external" href="https://git.ccfe.ac.uk/cherab/cherab-core/tree/master/docs/demonstrations/line_emission/balmer_series.py">here</a>.
Start by importing all required modules and creating world.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># External imports</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Core and external imports</span>
<span class="kn">from</span> <span class="nn">raysect.core</span> <span class="k">import</span> <span class="n">Vector3D</span><span class="p">,</span> <span class="n">Point3D</span>
<span class="kn">from</span> <span class="nn">raysect.core.ray</span> <span class="k">import</span> <span class="n">Ray</span> <span class="k">as</span> <span class="n">CoreRay</span>
<span class="kn">from</span> <span class="nn">raysect.primitive.mesh</span> <span class="k">import</span> <span class="n">Mesh</span><span class="p">,</span> <span class="n">import_stl</span>
<span class="kn">from</span> <span class="nn">raysect.optical.material.absorber</span> <span class="k">import</span> <span class="n">AbsorbingSurface</span>
<span class="kn">from</span> <span class="nn">raysect.optical.observer</span> <span class="k">import</span> <span class="n">FibreOptic</span><span class="p">,</span> <span class="n">SpectralPipeline0D</span>
<span class="kn">from</span> <span class="nn">raysect.optical</span> <span class="k">import</span> <span class="n">World</span><span class="p">,</span> <span class="n">translate</span><span class="p">,</span> <span class="n">rotate</span><span class="p">,</span> <span class="n">rotate_basis</span>

<span class="c1"># Cherab and raysect imports</span>
<span class="kn">from</span> <span class="nn">cherab.atomic.core</span> <span class="k">import</span> <span class="n">Line</span>
<span class="kn">from</span> <span class="nn">cherab.atomic.elements</span> <span class="k">import</span> <span class="n">deuterium</span><span class="p">,</span> <span class="n">carbon</span>
<span class="kn">from</span> <span class="nn">cherab_contrib.simulation_data.solps.solps_plasma</span> <span class="k">import</span> <span class="n">SOLPSSimulation</span>
<span class="kn">from</span> <span class="nn">cherab.model.impact_excitation.pec_line</span> <span class="k">import</span> <span class="n">ExcitationLine</span><span class="p">,</span> <span class="n">RecombinationLine</span>
<span class="kn">from</span> <span class="nn">cherab_mastu.mast_cad_files</span> <span class="k">import</span> <span class="n">CENTRE_COLUMN</span><span class="p">,</span> <span class="n">LOWER_DIVERTOR_ARMOUR</span>


<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
<span class="n">world</span> <span class="o">=</span> <span class="n">World</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="loading-plasma-and-machine-geometry">
<h2>Loading Plasma and machine geometry<a class="headerlink" href="#loading-plasma-and-machine-geometry" title="Permalink to this headline">¶</a></h2>
<p>Load all parts of the machine mesh from files. In this example we only need the centre column
and divertor.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MESH_PARTS</span> <span class="o">=</span> <span class="n">CENTRE_COLUMN</span> <span class="o">+</span> <span class="n">LOWER_DIVERTOR_ARMOUR</span>

<span class="k">for</span> <span class="n">cad_file</span> <span class="ow">in</span> <span class="n">MESH_PARTS</span><span class="p">:</span>
    <span class="n">directory</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">cad_file</span><span class="p">)</span>
    <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;importing </span><span class="si">{}</span><span class="s2"> ...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
    <span class="n">Mesh</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">cad_file</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">world</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">AbsorbingSurface</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>The core Plasma object will be populated from the output of a MAST-U SOLPS simulation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load plasma from SOLPS model</span>
<span class="n">mds_server</span> <span class="o">=</span> <span class="s1">&#39;solps-mdsplus.aug.ipp.mpg.de:8001&#39;</span>
<span class="n">ref_number</span> <span class="o">=</span> <span class="mi">69636</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">SOLPSSimulation</span><span class="o">.</span><span class="n">load_from_mdsplus</span><span class="p">(</span><span class="n">mds_server</span><span class="p">,</span> <span class="n">ref_number</span><span class="p">)</span>
<span class="n">plasma</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">plasma</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">mesh</span>
<span class="n">vessel</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vessel</span>
</pre></div>
</div>
<p>We will some lines from the Balmer series in our divertor example. These lines are
explained in another tutorial.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup deuterium lines</span>
<span class="n">d_alpha</span> <span class="o">=</span> <span class="n">Line</span><span class="p">(</span><span class="n">deuterium</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">wavelength</span><span class="o">=</span><span class="mf">656.19</span><span class="p">)</span>
<span class="n">d_beta</span> <span class="o">=</span> <span class="n">Line</span><span class="p">(</span><span class="n">deuterium</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">wavelength</span><span class="o">=</span><span class="mf">486.1</span><span class="p">)</span>
<span class="n">d_gamma</span> <span class="o">=</span> <span class="n">Line</span><span class="p">(</span><span class="n">deuterium</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">wavelength</span><span class="o">=</span><span class="mf">433.99</span><span class="p">)</span>
<span class="n">d_delta</span> <span class="o">=</span> <span class="n">Line</span><span class="p">(</span><span class="n">deuterium</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">wavelength</span><span class="o">=</span><span class="mf">410.2</span><span class="p">)</span>
<span class="n">d_epsilon</span> <span class="o">=</span> <span class="n">Line</span><span class="p">(</span><span class="n">deuterium</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">wavelength</span><span class="o">=</span><span class="mi">397</span><span class="p">)</span>

<span class="n">d_ion_species</span> <span class="o">=</span> <span class="n">plasma</span><span class="o">.</span><span class="n">get_species</span><span class="p">(</span><span class="n">deuterium</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">d_atom_species</span> <span class="o">=</span> <span class="n">plasma</span><span class="o">.</span><span class="n">get_species</span><span class="p">(</span><span class="n">deuterium</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">d_alpha_excit</span> <span class="o">=</span> <span class="n">ExcitationLine</span><span class="p">(</span><span class="n">d_alpha</span><span class="p">,</span> <span class="n">plasma</span><span class="o">.</span><span class="n">electron_distribution</span><span class="p">,</span> <span class="n">d_atom_species</span><span class="p">,</span> <span class="n">inside_outside</span><span class="o">=</span><span class="n">plasma</span><span class="o">.</span><span class="n">inside_outside</span><span class="p">)</span>
<span class="n">d_alpha_excit</span><span class="o">.</span><span class="n">add_emitter_to_world</span><span class="p">(</span><span class="n">world</span><span class="p">,</span> <span class="n">plasma</span><span class="p">)</span>
<span class="n">d_alpha_recom</span> <span class="o">=</span> <span class="n">RecombinationLine</span><span class="p">(</span><span class="n">d_alpha</span><span class="p">,</span> <span class="n">plasma</span><span class="o">.</span><span class="n">electron_distribution</span><span class="p">,</span> <span class="n">d_ion_species</span><span class="p">,</span> <span class="n">inside_outside</span><span class="o">=</span><span class="n">plasma</span><span class="o">.</span><span class="n">inside_outside</span><span class="p">)</span>
<span class="n">d_alpha_recom</span><span class="o">.</span><span class="n">add_emitter_to_world</span><span class="p">(</span><span class="n">world</span><span class="p">,</span> <span class="n">plasma</span><span class="p">)</span>

<span class="n">d_gamma_excit</span> <span class="o">=</span> <span class="n">ExcitationLine</span><span class="p">(</span><span class="n">d_gamma</span><span class="p">,</span> <span class="n">plasma</span><span class="o">.</span><span class="n">electron_distribution</span><span class="p">,</span> <span class="n">d_atom_species</span><span class="p">,</span> <span class="n">inside_outside</span><span class="o">=</span><span class="n">plasma</span><span class="o">.</span><span class="n">inside_outside</span><span class="p">)</span>
<span class="n">d_gamma_excit</span><span class="o">.</span><span class="n">add_emitter_to_world</span><span class="p">(</span><span class="n">world</span><span class="p">,</span> <span class="n">plasma</span><span class="p">)</span>
<span class="n">d_gamma_recom</span> <span class="o">=</span> <span class="n">RecombinationLine</span><span class="p">(</span><span class="n">d_gamma</span><span class="p">,</span> <span class="n">plasma</span><span class="o">.</span><span class="n">electron_distribution</span><span class="p">,</span> <span class="n">d_ion_species</span><span class="p">,</span> <span class="n">inside_outside</span><span class="o">=</span><span class="n">plasma</span><span class="o">.</span><span class="n">inside_outside</span><span class="p">)</span>
<span class="n">d_gamma_recom</span><span class="o">.</span><span class="n">add_emitter_to_world</span><span class="p">(</span><span class="n">world</span><span class="p">,</span> <span class="n">plasma</span><span class="p">)</span>

<span class="n">d_beta_excit</span> <span class="o">=</span> <span class="n">ExcitationLine</span><span class="p">(</span><span class="n">d_beta</span><span class="p">,</span> <span class="n">plasma</span><span class="o">.</span><span class="n">electron_distribution</span><span class="p">,</span> <span class="n">d_atom_species</span><span class="p">,</span> <span class="n">inside_outside</span><span class="o">=</span><span class="n">plasma</span><span class="o">.</span><span class="n">inside_outside</span><span class="p">)</span>
<span class="n">d_beta_excit</span><span class="o">.</span><span class="n">add_emitter_to_world</span><span class="p">(</span><span class="n">world</span><span class="p">,</span> <span class="n">plasma</span><span class="p">)</span>
<span class="n">d_beta_recom</span> <span class="o">=</span> <span class="n">RecombinationLine</span><span class="p">(</span><span class="n">d_beta</span><span class="p">,</span> <span class="n">plasma</span><span class="o">.</span><span class="n">electron_distribution</span><span class="p">,</span> <span class="n">d_ion_species</span><span class="p">,</span> <span class="n">inside_outside</span><span class="o">=</span><span class="n">plasma</span><span class="o">.</span><span class="n">inside_outside</span><span class="p">)</span>
<span class="n">d_beta_recom</span><span class="o">.</span><span class="n">add_emitter_to_world</span><span class="p">(</span><span class="n">world</span><span class="p">,</span> <span class="n">plasma</span><span class="p">)</span>

<span class="n">d_delta_excit</span> <span class="o">=</span> <span class="n">ExcitationLine</span><span class="p">(</span><span class="n">d_delta</span><span class="p">,</span> <span class="n">plasma</span><span class="o">.</span><span class="n">electron_distribution</span><span class="p">,</span> <span class="n">d_atom_species</span><span class="p">,</span> <span class="n">inside_outside</span><span class="o">=</span><span class="n">plasma</span><span class="o">.</span><span class="n">inside_outside</span><span class="p">)</span>
<span class="n">d_delta_excit</span><span class="o">.</span><span class="n">add_emitter_to_world</span><span class="p">(</span><span class="n">world</span><span class="p">,</span> <span class="n">plasma</span><span class="p">)</span>
<span class="n">d_delta_recom</span> <span class="o">=</span> <span class="n">RecombinationLine</span><span class="p">(</span><span class="n">d_delta</span><span class="p">,</span> <span class="n">plasma</span><span class="o">.</span><span class="n">electron_distribution</span><span class="p">,</span> <span class="n">d_ion_species</span><span class="p">,</span> <span class="n">inside_outside</span><span class="o">=</span><span class="n">plasma</span><span class="o">.</span><span class="n">inside_outside</span><span class="p">)</span>
<span class="n">d_delta_recom</span><span class="o">.</span><span class="n">add_emitter_to_world</span><span class="p">(</span><span class="n">world</span><span class="p">,</span> <span class="n">plasma</span><span class="p">)</span>

<span class="n">d_epsilon_excit</span> <span class="o">=</span> <span class="n">ExcitationLine</span><span class="p">(</span><span class="n">d_epsilon</span><span class="p">,</span> <span class="n">plasma</span><span class="o">.</span><span class="n">electron_distribution</span><span class="p">,</span> <span class="n">d_atom_species</span><span class="p">,</span> <span class="n">inside_outside</span><span class="o">=</span><span class="n">plasma</span><span class="o">.</span><span class="n">inside_outside</span><span class="p">)</span>
<span class="n">d_epsilon_excit</span><span class="o">.</span><span class="n">add_emitter_to_world</span><span class="p">(</span><span class="n">world</span><span class="p">,</span> <span class="n">plasma</span><span class="p">)</span>
<span class="n">d_epsilon_recom</span> <span class="o">=</span> <span class="n">RecombinationLine</span><span class="p">(</span><span class="n">d_epsilon</span><span class="p">,</span> <span class="n">plasma</span><span class="o">.</span><span class="n">electron_distribution</span><span class="p">,</span> <span class="n">d_ion_species</span><span class="p">,</span> <span class="n">inside_outside</span><span class="o">=</span><span class="n">plasma</span><span class="o">.</span><span class="n">inside_outside</span><span class="p">)</span>
<span class="n">d_epsilon_recom</span><span class="o">.</span><span class="n">add_emitter_to_world</span><span class="p">(</span><span class="n">world</span><span class="p">,</span> <span class="n">plasma</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="optical-fibre-setup">
<h2>Optical Fibre setup<a class="headerlink" href="#optical-fibre-setup" title="Permalink to this headline">¶</a></h2>
<p>Setup an example MAST-U observation point with the <cite>FibreOptic</cite> observer class.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fibre position and observation direction</span>
<span class="n">start_point</span> <span class="o">=</span> <span class="n">Point3D</span><span class="p">(</span><span class="mf">1.669</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.6502</span><span class="p">)</span>
<span class="n">forward_vector</span> <span class="o">=</span> <span class="n">Vector3D</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">1.669</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">+</span><span class="mf">1.6502</span><span class="p">)</span><span class="o">.</span><span class="n">normalise</span><span class="p">()</span>
<span class="n">up_vector</span> <span class="o">=</span> <span class="n">Vector3D</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

<span class="n">spectra</span> <span class="o">=</span> <span class="n">SpectralPipeline0D</span><span class="p">()</span>
<span class="n">fibre</span> <span class="o">=</span> <span class="n">FibreOptic</span><span class="p">([</span><span class="n">spectra</span><span class="p">],</span> <span class="n">acceptance_angle</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">spectral_bins</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="n">spectral_rays</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                   <span class="n">pixel_samples</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">translate</span><span class="p">(</span><span class="o">*</span><span class="n">start_point</span><span class="p">)</span><span class="o">*</span><span class="n">rotate_basis</span><span class="p">(</span><span class="n">forward_vector</span><span class="p">,</span> <span class="n">up_vector</span><span class="p">),</span> <span class="n">parent</span><span class="o">=</span><span class="n">world</span><span class="p">)</span>

<span class="n">fibre</span><span class="o">.</span><span class="n">min_wavelength</span> <span class="o">=</span> <span class="mf">350.0</span>
<span class="n">fibre</span><span class="o">.</span><span class="n">max_wavelength</span> <span class="o">=</span> <span class="mf">700.0</span>

<span class="n">fibre</span><span class="o">.</span><span class="n">observe</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure align-center" id="id1">
<img alt="../../_images/balmer_series_spectra1.png" src="../../_images/balmer_series_spectra1.png" />
<p class="caption"><span class="caption-text">Balmer series spectrum measured with an optical fibre pointing into the
MAST-U divertor.</span></p>
</div>
</div>
<div class="section" id="sampling-plasma-parameters-along-ray-trajectory">
<h2>Sampling plasma parameters along ray trajectory<a class="headerlink" href="#sampling-plasma-parameters-along-ray-trajectory" title="Permalink to this headline">¶</a></h2>
<p>The easiest way to understand the resulting spectra is to look at the predicted
emission and plasma parameters along the ray trajectory. Start by finding
the intersection point so that we can parameterise the ray trajectory with
a parametric line equation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find the next intersection point of the ray with the world</span>
<span class="n">intersection</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">hit</span><span class="p">(</span><span class="n">CoreRay</span><span class="p">(</span><span class="n">start_point</span><span class="p">,</span> <span class="n">forward_vector</span><span class="p">))</span>
<span class="k">if</span> <span class="n">intersection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">hit_point</span> <span class="o">=</span> <span class="n">intersection</span><span class="o">.</span><span class="n">hit_point</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">intersection</span><span class="o">.</span><span class="n">primitive_to_world</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;No intersection with the vessel was found.&quot;</span><span class="p">)</span>

<span class="c1"># Traverse the ray with equation for a parametric line,</span>
<span class="c1"># i.e. t=0-&gt;1 traverses the ray path.</span>
<span class="n">parametric_vector</span> <span class="o">=</span> <span class="n">start_point</span><span class="o">.</span><span class="n">vector_to</span><span class="p">(</span><span class="n">hit_point</span><span class="p">)</span>
<span class="n">t_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
</pre></div>
</div>
<p>Next loop over the ray positions and sample the relevant parameters.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup some containers for useful parameters along the ray trajectory</span>
<span class="n">ray_r_points</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ray_z_points</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">distance</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">te</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ne</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">dalpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t_samples</span><span class="p">))</span>
<span class="n">dgamma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t_samples</span><span class="p">))</span>
<span class="n">dbeta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t_samples</span><span class="p">))</span>
<span class="n">ddelta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t_samples</span><span class="p">))</span>
<span class="n">depsilon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t_samples</span><span class="p">))</span>

<span class="c1"># get the electron distribution</span>
<span class="n">electrons</span> <span class="o">=</span> <span class="n">plasma</span><span class="o">.</span><span class="n">electron_distribution</span>

<span class="c1"># At each ray position sample the parameters of interest.</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">t_samples</span><span class="p">):</span>
    <span class="c1"># Get new sample point location and log distance</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">start_point</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">parametric_vector</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">t</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">start_point</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">parametric_vector</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">t</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">start_point</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">parametric_vector</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">t</span>
    <span class="n">sample_point</span> <span class="o">=</span> <span class="n">Point3D</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
    <span class="n">ray_r_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">ray_z_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">distance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start_point</span><span class="o">.</span><span class="n">distance_to</span><span class="p">(</span><span class="n">sample_point</span><span class="p">))</span>

    <span class="c1"># Sample plasma conditions</span>
    <span class="n">te</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">electrons</span><span class="o">.</span><span class="n">effective_temperature</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
    <span class="n">ne</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">electrons</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>

    <span class="c1"># Log magnitude of emission</span>
    <span class="n">dalpha</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_alpha_excit</span><span class="o">.</span><span class="n">emission_at_point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="n">d_alpha_recom</span><span class="o">.</span><span class="n">emission_at_point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
    <span class="n">dgamma</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_gamma_excit</span><span class="o">.</span><span class="n">emission_at_point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="n">d_gamma_recom</span><span class="o">.</span><span class="n">emission_at_point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
    <span class="n">dbeta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_beta_excit</span><span class="o">.</span><span class="n">emission_at_point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="n">d_beta_recom</span><span class="o">.</span><span class="n">emission_at_point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
    <span class="n">ddelta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_delta_excit</span><span class="o">.</span><span class="n">emission_at_point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="n">d_delta_recom</span><span class="o">.</span><span class="n">emission_at_point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
    <span class="n">depsilon</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_epsilon_excit</span><span class="o">.</span><span class="n">emission_at_point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="n">d_epsilon_recom</span><span class="o">.</span><span class="n">emission_at_point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="example-plots">
<h2>Example plots<a class="headerlink" href="#example-plots" title="Permalink to this headline">¶</a></h2>
<p>Here are some example plots that can be made with collected profiles.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Normalise the emission arrays</span>
<span class="n">dalpha</span> <span class="o">/=</span> <span class="n">dalpha</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">dgamma</span> <span class="o">/=</span> <span class="n">dgamma</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">dbeta</span> <span class="o">/=</span> <span class="n">dbeta</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">ddelta</span> <span class="o">/=</span> <span class="n">ddelta</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">depsilon</span> <span class="o">/=</span> <span class="n">depsilon</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># Plot the trajectory parameters</span>
<span class="n">sim</span><span class="o">.</span><span class="n">plot_pec_emission_lines</span><span class="p">([</span><span class="n">d_alpha_excit</span><span class="p">,</span> <span class="n">d_alpha_recom</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;D_alpha&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ray_r_points</span><span class="p">,</span> <span class="n">ray_z_points</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ray_r_points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ray_z_points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;b.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ray_r_points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ray_z_points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;r.&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="n">te</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Ray distance (m)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Electron temperature (eV)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Electron temperature (eV) along ray path&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="n">ne</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Ray distance (m)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Electron density (m^-3)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Electron density (m^-3) along ray path&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="n">dalpha</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Dalpha&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="n">dgamma</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Dgamma&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="n">dbeta</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Dbeta&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="n">ddelta</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Ddelta&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="n">depsilon</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Depsilon&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Ray distance (m)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Normalised emission&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Normalised emission along ray path&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure align-center" id="id2">
<img alt="../../_images/poloidal_dalpha_emission.png" src="../../_images/poloidal_dalpha_emission.png" />
<p class="caption"><span class="caption-text">D-alpha emission in the poloidal plane. The ray trajectory is overplotted with
the start and end points indicated in blue and red respectively.</span></p>
</div>
<div class="figure align-center" id="id3">
<img alt="../../_images/te_ray_trajectory.png" src="../../_images/te_ray_trajectory.png" />
<p class="caption"><span class="caption-text">Electron temperature from the plasma sampled along the ray trajectory.</span></p>
</div>
<div class="figure align-center" id="id4">
<img alt="../../_images/ne_ray_trajectory.png" src="../../_images/ne_ray_trajectory.png" />
<p class="caption"><span class="caption-text">Electron density from the plasma sampled along the ray trajectory.</span></p>
</div>
<div class="figure align-center" id="id5">
<img alt="../../_images/normalised_emission_ray_trajectory.png" src="../../_images/normalised_emission_ray_trajectory.png" />
<p class="caption"><span class="caption-text">Normalised balmer series emission plotted along the ray trajectory.</span></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, CHERAB Team.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.01',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>