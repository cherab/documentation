

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2D Mesh Plasmas &mdash; Cherab 1.4.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Cherab
          

          
          </a>

          
            
            
              <div class="version">
                1.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../welcome.html">1. Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../licence.html">2. Licence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../governance.html">3. Project Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation_and_structure.html">4. Installation and Project Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../available_modules.html">5. Available Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../atomic/atomic_data.html">6. Atomic Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plasmas/plasmas.html">7. Plasmas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../models/emission_models.html">8. Emission Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../math/math.html">9. Function Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/tools.html">10. Tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Demonstrations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../demonstrations.html">Atomic Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demonstrations.html#creating-plasmas">Creating Plasmas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demonstrations.html#surface-radiation-loads">Surface Radiation Loads</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demonstrations.html#active-spectroscopy">Active Spectroscopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demonstrations.html#passive-spectroscopy">Passive Spectroscopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demonstrations.html#bolometry">Bolometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demonstrations.html#geometry-matrices">Geometry Matrices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demonstrations.html#code-examples-gallery">Code examples gallery</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Cherab</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>2D Mesh Plasmas</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/demonstrations/plasmas/mesh2d_plasma.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="d-mesh-plasmas">
<span id="mesh2d-plasma"></span><h1>2D Mesh Plasmas<a class="headerlink" href="#d-mesh-plasmas" title="Permalink to this headline">¶</a></h1>
<p>This demonstration shows how to define a set of plasma distributions using 2D meshes
that are revolved around the z-axis. This use case is commonly encountered when we
already have a plasma solution that has been computed with a fluid code or
particle-in-cell code. These codes typically export their plasma solutions on a mesh
in a 2D plane, assuming a symmetry axis. The plasma values are defined either
at the mesh vertices or inside the cells.</p>
<p>These types of plasmas can be achieved in Cherab with Raysect’s mesh interpolators,
<a class="reference external" href="https://raysect.github.io/documentation/api_reference/core/functions.html#raysect.core.math.interpolators.discrete2dmesh.Discrete2DMesh">Discrete2DMesh</a>
and <a class="reference external" href="https://raysect.github.io/documentation/api_reference/core/functions.html#raysect.core.math.interpolators.interpolator2dmesh.Interpolator2DMesh">Interpolator2DMesh</a>.
Both mesh functions are defined on a triangular mesh. The mesh vertex coordinates and
triangle definitions are given as arguments. The Discrete2DMesh defines it’s values
as constant inside each triangle, with the triangle values supplied as an argument.
The Interpolator2DMesh takes values defined at the triangle vertices and performs
Barycentric interpolation within each triangle. Both 2D mesh functions can be
promoted to 3D functions with the AxisymmetricMapper class, which maps a 2D r-z
function around the z-axis.</p>
<p>In this example we create a simple triangular mesh from scratch and sample some
analytic functions describing a cylindrically symmetric plasma column at the mesh
vertices. However, in real use cases you would use the mesh description
supplied by the plasma simulation code.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="c1"># Copyright 2016-2018 Euratom</span>
<span class="c1"># Copyright 2016-2018 United Kingdom Atomic Energy Authority</span>
<span class="c1"># Copyright 2016-2018 Centro de Investigaciones Energéticas, Medioambientales y Tecnológicas</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the EUPL, Version 1.1 or – as soon they will be approved by the</span>
<span class="c1"># European Commission - subsequent versions of the EUPL (the &quot;Licence&quot;);</span>
<span class="c1"># You may not use this work except in compliance with the Licence.</span>
<span class="c1"># You may obtain a copy of the Licence at:</span>
<span class="c1">#</span>
<span class="c1"># https://joinup.ec.europa.eu/software/page/eupl5</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software distributed</span>
<span class="c1"># under the Licence is distributed on an &quot;AS IS&quot; basis, WITHOUT WARRANTIES OR</span>
<span class="c1"># CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1">#</span>
<span class="c1"># See the Licence for the specific language governing permissions and limitations</span>
<span class="c1"># under the Licence.</span>


<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.constants</span> <span class="kn">import</span> <span class="n">electron_mass</span><span class="p">,</span> <span class="n">atomic_mass</span>
<span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">Delaunay</span>

<span class="kn">from</span> <span class="nn">raysect.core.math.function.float</span> <span class="kn">import</span> <span class="n">Interpolator2DMesh</span>
<span class="kn">from</span> <span class="nn">raysect.primitive</span> <span class="kn">import</span> <span class="n">Cylinder</span>
<span class="kn">from</span> <span class="nn">raysect.optical</span> <span class="kn">import</span> <span class="n">World</span><span class="p">,</span> <span class="n">translate</span><span class="p">,</span> <span class="n">Point3D</span><span class="p">,</span> <span class="n">Vector3D</span><span class="p">,</span> <span class="n">rotate_basis</span><span class="p">,</span> <span class="n">Spectrum</span>
<span class="kn">from</span> <span class="nn">raysect.optical.observer</span> <span class="kn">import</span> <span class="n">PinholeCamera</span><span class="p">,</span> <span class="n">PowerPipeline2D</span>

<span class="kn">from</span> <span class="nn">cherab.core</span> <span class="kn">import</span> <span class="n">Species</span><span class="p">,</span> <span class="n">Maxwellian</span><span class="p">,</span> <span class="n">Plasma</span><span class="p">,</span> <span class="n">Line</span>
<span class="kn">from</span> <span class="nn">cherab.core.math</span> <span class="kn">import</span> <span class="n">sample3d</span><span class="p">,</span> <span class="n">AxisymmetricMapper</span>
<span class="kn">from</span> <span class="nn">cherab.core.atomic</span> <span class="kn">import</span> <span class="n">deuterium</span>
<span class="kn">from</span> <span class="nn">cherab.core.model</span> <span class="kn">import</span> <span class="n">ExcitationLine</span><span class="p">,</span> <span class="n">RecombinationLine</span>
<span class="kn">from</span> <span class="nn">cherab.openadas</span> <span class="kn">import</span> <span class="n">OpenADAS</span>


<span class="c1"># tunable parameters</span>
<span class="n">peak_density</span> <span class="o">=</span> <span class="mf">1e19</span>
<span class="n">peak_temperature</span> <span class="o">=</span> <span class="mi">2500</span>


<span class="k">def</span> <span class="nf">neutral_distribution</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">peak</span><span class="p">,</span> <span class="n">lcfs_radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A neutral profile that is constant outside the plasma,</span>
<span class="sd">       then exponentially decays inside the LCFS.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">lcfs_radius</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">peak</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="n">lcfs_radius</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">peak</span>


<span class="k">def</span> <span class="nf">ion_distribution</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">v_core</span><span class="p">,</span> <span class="n">v_lcfs</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">lcfs_radius</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A cylindrical plasma profile that follows a double</span>
<span class="sd">       quadratic between the LCFS and axisymmetric z axis.&quot;&quot;&quot;</span>

    <span class="c1"># evaluate pedestal-&gt; core function</span>
    <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">lcfs_radius</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">v_core</span> <span class="o">-</span> <span class="n">v_lcfs</span><span class="p">)</span> <span class="o">*</span>
                <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">r</span> <span class="o">/</span> <span class="n">lcfs_radius</span><span class="p">,</span> <span class="n">p</span><span class="p">)),</span> <span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">v_lcfs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>


<span class="c1">####################</span>
<span class="c1"># 2D Mesh creation #</span>

<span class="c1"># Make a triangular mesh in the r-z plane</span>

<span class="n">num_vertical_points</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">vertical_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">num_vertical_points</span><span class="p">)</span>
<span class="n">num_radial_points</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">radial_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">num_radial_points</span><span class="p">)</span>

<span class="n">vertex_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">num_vertical_points</span> <span class="o">*</span> <span class="n">num_radial_points</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_radial_points</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_vertical_points</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">num_vertical_points</span> <span class="o">+</span> <span class="n">j</span>
        <span class="n">vertex_coords</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">radial_points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">vertex_coords</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">vertical_points</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

<span class="c1"># perform Delaunay triangulation to produce triangular mesh</span>
<span class="n">triangles</span> <span class="o">=</span> <span class="n">Delaunay</span><span class="p">(</span><span class="n">vertex_coords</span><span class="p">)</span><span class="o">.</span><span class="n">simplices</span>

<span class="c1"># sample our plasma functions at the mesh vertices</span>
<span class="n">d0_vertex_densities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">neutral_distribution</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">peak_density</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">vertex_coords</span><span class="p">])</span>
<span class="n">d1_vertex_densities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ion_distribution</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">peak_density</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">vertex_coords</span><span class="p">])</span>
<span class="n">d1_vertex_temperatures</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ion_distribution</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">peak_temperature</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">vertex_coords</span><span class="p">])</span>


<span class="c1">###################</span>
<span class="c1"># plasma creation #</span>

<span class="n">world</span> <span class="o">=</span> <span class="n">World</span><span class="p">()</span>  <span class="c1"># setup scenegraph</span>

<span class="n">plasma</span> <span class="o">=</span> <span class="n">Plasma</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">world</span><span class="p">)</span>
<span class="n">plasma</span><span class="o">.</span><span class="n">atomic_data</span> <span class="o">=</span> <span class="n">OpenADAS</span><span class="p">(</span><span class="n">permit_extrapolation</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plasma</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">Cylinder</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">translate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">))</span>
<span class="n">plasma</span><span class="o">.</span><span class="n">geometry_transform</span> <span class="o">=</span> <span class="n">translate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># No net velocity for any species</span>
<span class="n">zero_velocity</span> <span class="o">=</span> <span class="n">Vector3D</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># define neutral species distribution</span>

<span class="c1"># create a 2D interpolator from the mesh coords and data samples</span>
<span class="n">d0_density_interp</span> <span class="o">=</span> <span class="n">Interpolator2DMesh</span><span class="p">(</span><span class="n">vertex_coords</span><span class="p">,</span> <span class="n">d0_vertex_densities</span><span class="p">,</span> <span class="n">triangles</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># map the 2D interpolator into a 3D function using the axisymmetry operator</span>
<span class="n">d0_density</span> <span class="o">=</span> <span class="n">AxisymmetricMapper</span><span class="p">(</span><span class="n">d0_density_interp</span><span class="p">)</span>
<span class="n">d0_temperature</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># constant 0.5eV temperature for all neutrals</span>
<span class="n">d0_distribution</span> <span class="o">=</span> <span class="n">Maxwellian</span><span class="p">(</span><span class="n">d0_density</span><span class="p">,</span> <span class="n">d0_temperature</span><span class="p">,</span> <span class="n">zero_velocity</span><span class="p">,</span>
                             <span class="n">deuterium</span><span class="o">.</span><span class="n">atomic_weight</span> <span class="o">*</span> <span class="n">atomic_mass</span><span class="p">)</span>
<span class="n">d0_species</span> <span class="o">=</span> <span class="n">Species</span><span class="p">(</span><span class="n">deuterium</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">d0_distribution</span><span class="p">)</span>

<span class="c1"># define deuterium ion species distribution</span>
<span class="n">d1_density_interp</span> <span class="o">=</span> <span class="n">Interpolator2DMesh</span><span class="p">(</span><span class="n">vertex_coords</span><span class="p">,</span> <span class="n">d1_vertex_densities</span><span class="p">,</span> <span class="n">triangles</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">d1_density</span> <span class="o">=</span> <span class="n">AxisymmetricMapper</span><span class="p">(</span><span class="n">d1_density_interp</span><span class="p">)</span>
<span class="n">d1_temperature_interp</span> <span class="o">=</span> <span class="n">Interpolator2DMesh</span><span class="p">(</span><span class="n">vertex_coords</span><span class="p">,</span> <span class="n">d1_vertex_temperatures</span><span class="p">,</span> <span class="n">triangles</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">d1_temperature</span> <span class="o">=</span> <span class="n">AxisymmetricMapper</span><span class="p">(</span><span class="n">d1_temperature_interp</span><span class="p">)</span>
<span class="n">d1_distribution</span> <span class="o">=</span> <span class="n">Maxwellian</span><span class="p">(</span><span class="n">d1_density</span><span class="p">,</span> <span class="n">d1_temperature</span><span class="p">,</span> <span class="n">zero_velocity</span><span class="p">,</span>
                             <span class="n">deuterium</span><span class="o">.</span><span class="n">atomic_weight</span> <span class="o">*</span> <span class="n">atomic_mass</span><span class="p">)</span>
<span class="n">d1_species</span> <span class="o">=</span> <span class="n">Species</span><span class="p">(</span><span class="n">deuterium</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">d1_distribution</span><span class="p">)</span>

<span class="c1"># define the electron distribution</span>
<span class="n">e_density_interp</span> <span class="o">=</span> <span class="n">Interpolator2DMesh</span><span class="p">(</span><span class="n">vertex_coords</span><span class="p">,</span> <span class="n">d1_vertex_densities</span><span class="p">,</span> <span class="n">triangles</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">e_density</span> <span class="o">=</span> <span class="n">AxisymmetricMapper</span><span class="p">(</span><span class="n">e_density_interp</span><span class="p">)</span>
<span class="n">e_temperature_interp</span> <span class="o">=</span> <span class="n">Interpolator2DMesh</span><span class="p">(</span><span class="n">vertex_coords</span><span class="p">,</span> <span class="n">d1_vertex_temperatures</span><span class="p">,</span> <span class="n">triangles</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">e_temperature</span> <span class="o">=</span> <span class="n">AxisymmetricMapper</span><span class="p">(</span><span class="n">e_temperature_interp</span><span class="p">)</span>
<span class="n">e_distribution</span> <span class="o">=</span> <span class="n">Maxwellian</span><span class="p">(</span><span class="n">e_density</span><span class="p">,</span> <span class="n">e_temperature</span><span class="p">,</span> <span class="n">zero_velocity</span><span class="p">,</span> <span class="n">electron_mass</span><span class="p">)</span>

<span class="c1"># define species</span>
<span class="n">plasma</span><span class="o">.</span><span class="n">b_field</span> <span class="o">=</span> <span class="n">Vector3D</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">plasma</span><span class="o">.</span><span class="n">electron_distribution</span> <span class="o">=</span> <span class="n">e_distribution</span>
<span class="n">plasma</span><span class="o">.</span><span class="n">composition</span> <span class="o">=</span> <span class="p">[</span><span class="n">d0_species</span><span class="p">,</span> <span class="n">d1_species</span><span class="p">]</span>

<span class="c1"># Add a balmer alpha line for visualisation purposes</span>
<span class="n">d_alpha_excit</span> <span class="o">=</span> <span class="n">ExcitationLine</span><span class="p">(</span><span class="n">Line</span><span class="p">(</span><span class="n">deuterium</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
<span class="n">plasma</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="n">d_alpha_excit</span><span class="p">]</span>


<span class="c1">####################</span>
<span class="c1"># Visualise Plasma #</span>

<span class="c1"># Run some plots to check the distribution functions and emission profile are as expected</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">r</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">t_samples</span> <span class="o">=</span> <span class="n">sample3d</span><span class="p">(</span><span class="n">d1_temperature</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">t_samples</span><span class="p">)),</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;r axis&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;z axis&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Ion temperature profile in r-z plane&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">r</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">t_samples</span> <span class="o">=</span> <span class="n">sample3d</span><span class="p">(</span><span class="n">d1_temperature</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">t_samples</span><span class="p">)),</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x axis&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y axis&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Ion temperature profile in x-y plane&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">r</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">t_samples</span> <span class="o">=</span> <span class="n">sample3d</span><span class="p">(</span><span class="n">d0_density</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">t_samples</span><span class="p">)),</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;r axis&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;z axis&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Neutral Density profile in r-z plane&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">xrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">yrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">d_alpha_rz_intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>
<span class="n">direction</span> <span class="o">=</span> <span class="n">Vector3D</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xrange</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">yrange</span><span class="p">):</span>
        <span class="n">emission</span> <span class="o">=</span> <span class="n">d_alpha_excit</span><span class="o">.</span><span class="n">emission</span><span class="p">(</span><span class="n">Point3D</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">direction</span><span class="p">,</span> <span class="n">Spectrum</span><span class="p">(</span><span class="mi">650</span><span class="p">,</span> <span class="mi">660</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">d_alpha_rz_intensity</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">emission</span><span class="o">.</span><span class="n">total</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">d_alpha_rz_intensity</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x axis&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y axis&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;D-alpha emission in x-y&quot;</span><span class="p">)</span>


<span class="n">camera</span> <span class="o">=</span> <span class="n">PinholeCamera</span><span class="p">((</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span> <span class="n">pipelines</span><span class="o">=</span><span class="p">[</span><span class="n">PowerPipeline2D</span><span class="p">()],</span> <span class="n">parent</span><span class="o">=</span><span class="n">world</span><span class="p">)</span>
<span class="n">camera</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">translate</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">rotate_basis</span><span class="p">(</span><span class="n">Vector3D</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Vector3D</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">camera</span><span class="o">.</span><span class="n">pixel_samples</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
<span class="n">camera</span><span class="o">.</span><span class="n">observe</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># this code can be used to plot the mesh, but it&#39;s quite slow</span>
<span class="c1"># for tri_index in range(triangles.shape[0]):</span>
<span class="c1">#     v1, v2, v3 = triangles[tri_index]</span>
<span class="c1">#     plt.plot([vertex_coords[v1, 0], vertex_coords[v2, 0], vertex_coords[v3, 0], vertex_coords[v1, 0]],</span>
<span class="c1">#              [vertex_coords[v1, 1], vertex_coords[v2, 1], vertex_coords[v3, 1], vertex_coords[v1, 1]], &#39;k&#39;)</span>
<span class="c1">#     plt.plot([vertex_coords[v1, 0], vertex_coords[v2, 0], vertex_coords[v3, 0], vertex_coords[v1, 0]],</span>
<span class="c1">#              [vertex_coords[v1, 1], vertex_coords[v2, 1], vertex_coords[v3, 1], vertex_coords[v1, 1]], &#39;.b&#39;)</span>
</pre></div>
</div>
<div class="figure align-center" id="id1">
<a class="reference internal image-reference" href="../../_images/mesh_plasma_slices.png"><img alt="../../_images/mesh_plasma_slices.png" src="../../_images/mesh_plasma_slices.png" style="width: 650px;" /></a>
<p class="caption"><span class="caption-text"><strong>Caption:</strong> Visualisation plots of slices through the plasma.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-center" id="id2">
<a class="reference internal image-reference" href="../../_images/mesh_plasma_column.png"><img alt="../../_images/mesh_plasma_column.png" src="../../_images/mesh_plasma_column.png" style="width: 450px;" /></a>
<p class="caption"><span class="caption-text"><strong>Caption:</strong> A camera rendering of the d-alpha light from the cylindrically symmetric
plasma column.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-center" id="id3">
<a class="reference internal image-reference" href="../../_images/mesh_for_plasma.png"><img alt="../../_images/mesh_for_plasma.png" src="../../_images/mesh_for_plasma.png" style="width: 450px;" /></a>
<p class="caption"><span class="caption-text"><strong>Caption:</strong> A visualisation of the underlying triangular mesh in the r-z plane. The
plasma values were defined at the triangle vertices.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2022, Cherab Team

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>