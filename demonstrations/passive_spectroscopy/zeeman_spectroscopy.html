

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Zeeman Spectroscopy &mdash; Cherab 1.3.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Cherab
          

          
          </a>

          
            
            
              <div class="version">
                1.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../welcome.html">1. Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../licence.html">2. Licence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../governance.html">3. Project Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation_and_structure.html">4. Installation and Project Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../available_modules.html">5. Available Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../atomic/atomic_data.html">6. Atomic Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plasmas/plasmas.html">7. Plasmas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../models/emission_models.html">8. Emission Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../math/math.html">9. Function Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/tools.html">10. Tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Demonstrations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../demonstrations.html">Atomic Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demonstrations.html#creating-plasmas">Creating Plasmas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demonstrations.html#surface-radiation-loads">Surface Radiation Loads</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demonstrations.html#active-spectroscopy">Active Spectroscopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demonstrations.html#passive-spectroscopy">Passive Spectroscopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demonstrations.html#bolometry">Bolometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demonstrations.html#geometry-matrices">Geometry Matrices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demonstrations.html#code-examples-gallery">Code examples gallery</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Cherab</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Zeeman Spectroscopy</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/demonstrations/passive_spectroscopy/zeeman_spectroscopy.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="zeeman-spectroscopy">
<span id="id1"></span><h1>Zeeman Spectroscopy<a class="headerlink" href="#zeeman-spectroscopy" title="Permalink to this headline">¶</a></h1>
<p>In the presence of magnetic field, spectral lines split into several components.
For high-resolution spectroscopy in magnetic confinement devices,
Zeeman effect must be taken into account. Ususally, Zeeman effect is used in
plasma diagnostics to determine spatial location of the radiation source, namely
high-field side scrape-off layer versus low-field side scrape-off layer.</p>
<p>Different Zeeman components have different polarisations, so-called <span class="math notranslate nohighlight">\(\pi\)</span>-
and <span class="math notranslate nohighlight">\(\sigma\)</span>-polarised components. Therefore, the observed spectrum depends
on the angle between the direction of observation and the magnetic field.
When observed along the magnetic field direction, only <span class="math notranslate nohighlight">\(\sigma\)</span>-polarised
components are visible.</p>
<p>Cherab contains the following models of Zeeman line shapes.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ZeemanTriplet</span></code> model can be used in the case when the magnetic field is
strong enough to disrupt the coupling between orbital and spin angular momenta
of the electron (Paschen–Back effect).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ParametrisedZeemanTriplet</span></code> should be used when the Paschen–Back effect is stil
observed, but the broadening due to the line’s fine structure cannot be ignored.
See A. Blom and C. Jupén, Parametrisation of the Zeeman effect for hydrogen-like
spectra in high-temperature plasmas, Plasma Phys. Control. Fusion 44 (2002)
<a class="reference external" href="https://doi.org/10.1088/0741-3335/44/7/312">1229-1241</a>.</p></li>
<li><p>In all other cases, the general <code class="docutils literal notranslate"><span class="pre">ZeemanMultiplet</span></code> model must be used. The input
data for this model can be obtained with the
<a class="reference external" href="https://www.adas.ac.uk/man/chap6-03.pdf">ADAS603</a> subroutines.</p></li>
</ul>
<p>In case of <span class="math notranslate nohighlight">\(D_{\alpha}\)</span> spectral line, all three models give the same results.
This demo shows how the spectrum depends on the angle between the
direction of observation and the magnetic field.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copyright 2016-2018 Euratom</span>
<span class="c1"># Copyright 2016-2018 United Kingdom Atomic Energy Authority</span>
<span class="c1"># Copyright 2016-2018 Centro de Investigaciones Energéticas, Medioambientales y Tecnológicas</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the EUPL, Version 1.1 or – as soon they will be approved by the</span>
<span class="c1"># European Commission - subsequent versions of the EUPL (the &quot;Licence&quot;);</span>
<span class="c1"># You may not use this work except in compliance with the Licence.</span>
<span class="c1"># You may obtain a copy of the Licence at:</span>
<span class="c1">#</span>
<span class="c1"># https://joinup.ec.europa.eu/software/page/eupl5</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software distributed</span>
<span class="c1"># under the Licence is distributed on an &quot;AS IS&quot; basis, WITHOUT WARRANTIES OR</span>
<span class="c1"># CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1">#</span>
<span class="c1"># See the Licence for the specific language governing permissions and limitations</span>
<span class="c1"># under the Licence.</span>


<span class="c1"># External imports</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">cos</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">deg2rad</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.constants</span> <span class="kn">import</span> <span class="n">electron_mass</span><span class="p">,</span> <span class="n">atomic_mass</span>
<span class="kn">from</span> <span class="nn">raysect.core.math.function.float</span> <span class="kn">import</span> <span class="n">Arg1D</span><span class="p">,</span> <span class="n">Constant1D</span>
<span class="kn">from</span> <span class="nn">raysect.optical</span> <span class="kn">import</span> <span class="n">World</span><span class="p">,</span> <span class="n">Vector3D</span><span class="p">,</span> <span class="n">Point3D</span><span class="p">,</span> <span class="n">Ray</span>
<span class="kn">from</span> <span class="nn">raysect.primitive</span> <span class="kn">import</span> <span class="n">Sphere</span>
<span class="kn">from</span> <span class="nn">raysect.optical.material.emitter.inhomogeneous</span> <span class="kn">import</span> <span class="n">NumericalIntegrator</span>

<span class="c1"># Cherab imports</span>
<span class="kn">from</span> <span class="nn">cherab.core</span> <span class="kn">import</span> <span class="n">Species</span><span class="p">,</span> <span class="n">Maxwellian</span><span class="p">,</span> <span class="n">Plasma</span><span class="p">,</span> <span class="n">Line</span>
<span class="kn">from</span> <span class="nn">cherab.core.atomic</span> <span class="kn">import</span> <span class="n">ZeemanStructure</span>
<span class="kn">from</span> <span class="nn">cherab.core.atomic.elements</span> <span class="kn">import</span> <span class="n">deuterium</span>
<span class="kn">from</span> <span class="nn">cherab.core.model</span> <span class="kn">import</span> <span class="n">ExcitationLine</span><span class="p">,</span> <span class="n">RecombinationLine</span><span class="p">,</span> <span class="n">ZeemanTriplet</span><span class="p">,</span> <span class="n">ParametrisedZeemanTriplet</span><span class="p">,</span> <span class="n">ZeemanMultiplet</span>
<span class="kn">from</span> <span class="nn">cherab.openadas</span> <span class="kn">import</span> <span class="n">OpenADAS</span>
<span class="kn">from</span> <span class="nn">cherab.tools.plasmas</span> <span class="kn">import</span> <span class="n">GaussianVolume</span>


<span class="c1"># tunables</span>
<span class="n">ion_density</span> <span class="o">=</span> <span class="mf">1e19</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.25</span>

<span class="c1"># setup scenegraph</span>
<span class="n">world</span> <span class="o">=</span> <span class="n">World</span><span class="p">()</span>

<span class="c1"># create atomic data source</span>
<span class="n">adas</span> <span class="o">=</span> <span class="n">OpenADAS</span><span class="p">(</span><span class="n">permit_extrapolation</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># PLASMA ----------------------------------------------------------------------</span>
<span class="n">plasma</span> <span class="o">=</span> <span class="n">Plasma</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">world</span><span class="p">)</span>
<span class="n">plasma</span><span class="o">.</span><span class="n">atomic_data</span> <span class="o">=</span> <span class="n">adas</span>
<span class="n">plasma</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">Sphere</span><span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="mf">5.0</span><span class="p">)</span>
<span class="n">plasma</span><span class="o">.</span><span class="n">geometry_transform</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">plasma</span><span class="o">.</span><span class="n">integrator</span> <span class="o">=</span> <span class="n">NumericalIntegrator</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="n">sigma</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">)</span>

<span class="c1"># define basic distributions</span>
<span class="n">d_density</span> <span class="o">=</span> <span class="n">GaussianVolume</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">ion_density</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">)</span>
<span class="n">e_density</span> <span class="o">=</span> <span class="n">GaussianVolume</span><span class="p">(</span><span class="n">ion_density</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">)</span>
<span class="n">temperature</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">GaussianVolume</span><span class="p">(</span><span class="mi">79</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
<span class="n">bulk_velocity</span> <span class="o">=</span> <span class="n">Vector3D</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">deuterium_mass</span> <span class="o">=</span> <span class="n">deuterium</span><span class="o">.</span><span class="n">atomic_weight</span> <span class="o">*</span> <span class="n">atomic_mass</span>
<span class="n">d0_distribution</span> <span class="o">=</span> <span class="n">Maxwellian</span><span class="p">(</span><span class="n">d_density</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">bulk_velocity</span><span class="p">,</span> <span class="n">deuterium_mass</span><span class="p">)</span>
<span class="n">d1_distribution</span> <span class="o">=</span> <span class="n">Maxwellian</span><span class="p">(</span><span class="n">d_density</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">bulk_velocity</span><span class="p">,</span> <span class="n">deuterium_mass</span><span class="p">)</span>
<span class="n">e_distribution</span> <span class="o">=</span> <span class="n">Maxwellian</span><span class="p">(</span><span class="n">e_density</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">bulk_velocity</span><span class="p">,</span> <span class="n">electron_mass</span><span class="p">)</span>

<span class="n">d0_species</span> <span class="o">=</span> <span class="n">Species</span><span class="p">(</span><span class="n">deuterium</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">d0_distribution</span><span class="p">)</span>
<span class="n">d1_species</span> <span class="o">=</span> <span class="n">Species</span><span class="p">(</span><span class="n">deuterium</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">d1_distribution</span><span class="p">)</span>

<span class="c1"># define magnetic field</span>
<span class="n">plasma</span><span class="o">.</span><span class="n">b_field</span> <span class="o">=</span> <span class="n">Vector3D</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">)</span>

<span class="c1"># define species</span>
<span class="n">plasma</span><span class="o">.</span><span class="n">electron_distribution</span> <span class="o">=</span> <span class="n">e_distribution</span>
<span class="n">plasma</span><span class="o">.</span><span class="n">composition</span> <span class="o">=</span> <span class="p">[</span><span class="n">d0_species</span><span class="p">,</span> <span class="n">d1_species</span><span class="p">]</span>

<span class="c1"># setup D-alpha line</span>
<span class="n">deuterium_I_656</span> <span class="o">=</span> <span class="n">Line</span><span class="p">(</span><span class="n">deuterium</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>  <span class="c1"># n = 3-&gt;2: 656.1nm</span>

<span class="c1"># add simple Zeeman triplet model to the plasma</span>
<span class="n">plasma</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">ExcitationLine</span><span class="p">(</span><span class="n">deuterium_I_656</span><span class="p">,</span> <span class="n">lineshape</span><span class="o">=</span><span class="n">ZeemanTriplet</span><span class="p">),</span>
    <span class="n">RecombinationLine</span><span class="p">(</span><span class="n">deuterium_I_656</span><span class="p">,</span> <span class="n">lineshape</span><span class="o">=</span><span class="n">ZeemanTriplet</span><span class="p">)</span>
<span class="p">]</span>

<span class="c1"># angles between the ray and the magnetic field direction</span>
<span class="n">angles</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">45.</span><span class="p">,</span> <span class="mf">90.</span><span class="p">)</span>

<span class="c1"># Ray-trace the spectrum for different angles between the ray and the magnetic field</span>
<span class="n">triplet</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">angles</span><span class="p">:</span>
    <span class="n">angle_rad</span> <span class="o">=</span> <span class="n">deg2rad</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">Ray</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="n">Point3D</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">),</span> <span class="o">-</span><span class="mi">5</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)),</span> <span class="n">direction</span><span class="o">=</span><span class="n">Vector3D</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sin</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)),</span>
            <span class="n">min_wavelength</span><span class="o">=</span><span class="mf">655.4</span><span class="p">,</span> <span class="n">max_wavelength</span><span class="o">=</span><span class="mf">656.8</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">triplet</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">world</span><span class="p">))</span>

<span class="c1"># add parametrised Zeeman triplet model to the plasma</span>
<span class="c1"># this model taeks into account additional broadening due to the line&#39;s fine structure</span>
<span class="c1"># without resolving the individual components of the fine structure</span>
<span class="n">plasma</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">ExcitationLine</span><span class="p">(</span><span class="n">deuterium_I_656</span><span class="p">,</span> <span class="n">lineshape</span><span class="o">=</span><span class="n">ParametrisedZeemanTriplet</span><span class="p">),</span>
    <span class="n">RecombinationLine</span><span class="p">(</span><span class="n">deuterium_I_656</span><span class="p">,</span> <span class="n">lineshape</span><span class="o">=</span><span class="n">ParametrisedZeemanTriplet</span><span class="p">)</span>
<span class="p">]</span>

<span class="c1"># Ray-trace the spectrum again</span>
<span class="n">parametrised_triplet</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">angles</span><span class="p">:</span>
    <span class="n">angle_rad</span> <span class="o">=</span> <span class="n">deg2rad</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">Ray</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="n">Point3D</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">),</span> <span class="o">-</span><span class="mi">5</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)),</span> <span class="n">direction</span><span class="o">=</span><span class="n">Vector3D</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sin</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)),</span>
            <span class="n">min_wavelength</span><span class="o">=</span><span class="mf">655.4</span><span class="p">,</span> <span class="n">max_wavelength</span><span class="o">=</span><span class="mf">656.8</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">parametrised_triplet</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">world</span><span class="p">))</span>

<span class="c1"># add ZeemanMultiplet model to the plasma</span>

<span class="c1"># initialising the splitting function</span>
<span class="n">BOHR_MAGNETON</span> <span class="o">=</span> <span class="mf">5.78838180123e-5</span>  <span class="c1"># in eV/T</span>
<span class="n">HC_EV_NM</span> <span class="o">=</span> <span class="mf">1239.8419738620933</span>  <span class="c1"># (Planck constant in eV s) x (speed of light in nm/s)</span>
<span class="n">wavelength</span> <span class="o">=</span> <span class="n">plasma</span><span class="o">.</span><span class="n">atomic_data</span><span class="o">.</span><span class="n">wavelength</span><span class="p">(</span><span class="n">deuterium</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">photon_energy</span> <span class="o">=</span> <span class="n">HC_EV_NM</span> <span class="o">/</span> <span class="n">wavelength</span>

<span class="n">pi_components</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Constant1D</span><span class="p">(</span><span class="n">wavelength</span><span class="p">),</span> <span class="n">Constant1D</span><span class="p">(</span><span class="mf">1.0</span><span class="p">))]</span>
<span class="n">sigma_minus_components</span> <span class="o">=</span> <span class="p">[(</span><span class="n">HC_EV_NM</span> <span class="o">/</span> <span class="p">(</span><span class="n">photon_energy</span> <span class="o">-</span> <span class="n">BOHR_MAGNETON</span> <span class="o">*</span> <span class="n">Arg1D</span><span class="p">()),</span> <span class="n">Constant1D</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))]</span>
<span class="n">sigma_plus_components</span> <span class="o">=</span> <span class="p">[(</span><span class="n">HC_EV_NM</span> <span class="o">/</span> <span class="p">(</span><span class="n">photon_energy</span> <span class="o">+</span> <span class="n">BOHR_MAGNETON</span> <span class="o">*</span> <span class="n">Arg1D</span><span class="p">()),</span> <span class="n">Constant1D</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))]</span>

<span class="n">zeeman_structure</span> <span class="o">=</span> <span class="n">ZeemanStructure</span><span class="p">(</span><span class="n">pi_components</span><span class="p">,</span> <span class="n">sigma_plus_components</span><span class="p">,</span> <span class="n">sigma_minus_components</span><span class="p">)</span>

<span class="n">plasma</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">ExcitationLine</span><span class="p">(</span><span class="n">deuterium_I_656</span><span class="p">,</span> <span class="n">lineshape</span><span class="o">=</span><span class="n">ZeemanMultiplet</span><span class="p">,</span> <span class="n">lineshape_args</span><span class="o">=</span><span class="p">[</span><span class="n">zeeman_structure</span><span class="p">]),</span>
    <span class="n">RecombinationLine</span><span class="p">(</span><span class="n">deuterium_I_656</span><span class="p">,</span> <span class="n">lineshape</span><span class="o">=</span><span class="n">ZeemanMultiplet</span><span class="p">,</span> <span class="n">lineshape_args</span><span class="o">=</span><span class="p">[</span><span class="n">zeeman_structure</span><span class="p">])</span>
<span class="p">]</span>

<span class="c1"># Ray-trace the spectrum again</span>
<span class="n">multiplet</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">angles</span><span class="p">:</span>
    <span class="n">angle_rad</span> <span class="o">=</span> <span class="n">deg2rad</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">Ray</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="n">Point3D</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">),</span> <span class="o">-</span><span class="mi">5</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)),</span> <span class="n">direction</span><span class="o">=</span><span class="n">Vector3D</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sin</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)),</span>
            <span class="n">min_wavelength</span><span class="o">=</span><span class="mf">655.4</span><span class="p">,</span> <span class="n">max_wavelength</span><span class="o">=</span><span class="mf">656.8</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">multiplet</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">world</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">angle</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">angles</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">triplet</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">triplet</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">samples</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ZeemanTriplet&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">parametrised_triplet</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">parametrised_triplet</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">samples</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ParametrisedZeemanTriplet&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">multiplet</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">multiplet</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">samples</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ZeemanMultiplet&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (nm)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Radiance (W/m^2/str/nm)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Observed spectrum at </span><span class="si">{}</span><span class="s1">$\degree$ angle between ray and magnetic field&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure align-center" id="id3">
<a class="reference internal image-reference" href="../../_images/zeeman_spectrum_0deg.png"><img alt="../../_images/zeeman_spectrum_0deg.png" src="../../_images/zeeman_spectrum_0deg.png" style="width: 450px;" /></a>
<p class="caption"><span class="caption-text"><strong>Caption:</strong> The <span class="math notranslate nohighlight">\(D_{\alpha}\)</span> spectrum observed along the magnetic field.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-center" id="id4">
<a class="reference internal image-reference" href="../../_images/zeeman_spectrum_45deg.png"><img alt="../../_images/zeeman_spectrum_45deg.png" src="../../_images/zeeman_spectrum_45deg.png" style="width: 450px;" /></a>
<p class="caption"><span class="caption-text"><strong>Caption:</strong> The <span class="math notranslate nohighlight">\(D_{\alpha}\)</span> spectrum observed at <span class="math notranslate nohighlight">\(45^{\circ}\)</span>
angle between the direction of ray and the magnetic field.</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-center" id="id5">
<a class="reference internal image-reference" href="../../_images/zeeman_spectrum_90deg.png"><img alt="../../_images/zeeman_spectrum_90deg.png" src="../../_images/zeeman_spectrum_90deg.png" style="width: 450px;" /></a>
<p class="caption"><span class="caption-text"><strong>Caption:</strong> The <span class="math notranslate nohighlight">\(D_{\alpha}\)</span> spectrum observed perpendicularly to the magnetic
field.</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, Cherab Team

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>